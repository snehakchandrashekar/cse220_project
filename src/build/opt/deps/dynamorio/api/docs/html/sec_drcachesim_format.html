<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>
<title>DynamoRIO: Trace Format</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DynamoRIO
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('sec_drcachesim_format.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Trace Format </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><code>drmemtrace</code> traces are records of all user mode retired instructions and memory accesses during the traced window.</p>
<p>A trace is presented to analysis tools as a stream of records. Each record entry is of type <a class="el" href="namespacedynamorio_1_1drmemtrace.html#ae4a471ed806967b2b6f911b6ef770704">dynamorio::drmemtrace::memref_t</a> and represents one instruction or data reference or a metadata operation such as a thread exit or marker. There are built-in scheduling markers providing the timestamp and cpu identifier on each thread transition. Other built-in markers indicate disruptions in user mode control flow such as signal handler entry and exit.</p>
<p>Each entry contains the common fields <code>type</code>, <code>pid</code>, and <code>tid</code>. The <code>type</code> field is used to identify the kind of each entry via a value of type <a class="el" href="namespacedynamorio_1_1drmemtrace.html#ab8531c7f66ccc0d7fe59f436844a295c">dynamorio::drmemtrace::trace_marker_type_t</a>. The <code>pid</code> and <code>tid</code> identify the process and software thread owning the entry. By default, all traced software threads are interleaved together, but with offline traces (see <a class="el" href="sec_drcachesim_offline.html">Offline Traces and Analysis</a>) each thread's trace can easily be analyzed separately as they are stored in separate files.</p>
<h1><a class="anchor" id="sec_drcachesim_format_instrs"></a>
Instruction Records</h1>
<p>Executed instructions are stored in <a class="el" href="structdynamorio_1_1drmemtrace_1_1__memref__instr__t.html">dynamorio::drmemtrace::_memref_instr_t</a>. The program counter and length of the encoded instruction are provided. The length can be used to compute the address of the subsequent instruction.</p>
<p>The raw encoding of the instruction is provided. This can be decoded using the drdecode decoder or any other decoder. An additional field <code>encoding_is_new</code> is provided to indicate when any cached decoding information should be invalidated due to possibly changed application code. (For online traces, encodings are not provided unless the option <code>-instr_encodings</code> is passed, as encodings add overhead and are not needed for many tools.)</p>
<p>Older legacy traces may not contain instruction encodings. For those traces, encodings for static code can be obtained by disassembling the application and library binaries. The provided interfaces module_mapper_t::get_loaded_modules() and module_mapper_t::find_mapped_trace_address() facilitate loading in copies of the binaries and reading the raw bytes for each instruction in order to obtain the opcode and full operand information. See also <a class="el" href="sec_drcachesim_core.html">Core Simulation Support</a>.</p>
<p>Whether conditional branches are taken or untaken is indicated by the instruction types <a class="el" href="namespacedynamorio_1_1drmemtrace.html#a00e926de2230d3f712dcae422e6cb59ca9c9d51773f51a184dbe43b9382cc305c">dynamorio::drmemtrace::TRACE_TYPE_INSTR_TAKEN_JUMP</a> and <a class="el" href="namespacedynamorio_1_1drmemtrace.html#a00e926de2230d3f712dcae422e6cb59ca93a6bfcd5d3af5e73765fe053fff98ae">dynamorio::drmemtrace::TRACE_TYPE_INSTR_UNTAKEN_JUMP</a>. The target of each indirect branch is explicitly provided by the "indirect_branch_target" field in <a class="el" href="namespacedynamorio_1_1drmemtrace.html#ae4a471ed806967b2b6f911b6ef770704">dynamorio::drmemtrace::memref_t</a>. If the program flow is changed by the kernel such as by signal delivery, the branch target is explicitly recorded in the trace in a metadata marker entry of type <a class="el" href="namespacedynamorio_1_1drmemtrace.html#ab8531c7f66ccc0d7fe59f436844a295ca3b75f9115bb4146ed5540412e36bdd5a">dynamorio::drmemtrace::TRACE_MARKER_TYPE_KERNEL_EVENT</a>.</p>
<h1><a class="anchor" id="sec_drcachesim_format_data"></a>
Memory Access Records</h1>
<p>Memory accesses (data loads and stores) are stored in <a class="el" href="structdynamorio_1_1drmemtrace_1_1__memref__data__t.html">dynamorio::drmemtrace::_memref_data_t</a>. The program counter of the instruction performing the memory access, the virtual address (convertable to physical: see <a class="el" href="sec_drcachesim_phys.html">Physical Addresses</a>), and the size are provided.</p>
<h1><a class="anchor" id="sec_drcachesim_format_other"></a>
Other Records</h1>
<p>Besides instruction and memory records, other trace entry types include <a class="el" href="structdynamorio_1_1drmemtrace_1_1__memref__marker__t.html">dynamorio::drmemtrace::_memref_marker_t</a>, <a class="el" href="structdynamorio_1_1drmemtrace_1_1__memref__flush__t.html">dynamorio::drmemtrace::_memref_flush_t</a>, <a class="el" href="structdynamorio_1_1drmemtrace_1_1__memref__thread__exit__t.html">dynamorio::drmemtrace::_memref_thread_exit_t</a>, etc. These records provide specific inforamtion about events that can alter the program flow or the system's states.</p>
<p>Trace markers are particularly important to allow reconstruction of the program execution. Marker records in <a class="el" href="structdynamorio_1_1drmemtrace_1_1__memref__marker__t.html">dynamorio::drmemtrace::_memref_marker_t</a> provide metadata identifying some event that occurred at this point in the trace. Each marker record contains two additional fields:</p>
<ul>
<li><code>marker_type</code> - identifies the type of marker</li>
<li><code>marker_value</code> - carries the value of the marker</li>
</ul>
<p>Some of the more important markers are:</p>
<ul>
<li><a class="el" href="namespacedynamorio_1_1drmemtrace.html#ab8531c7f66ccc0d7fe59f436844a295ca3b75f9115bb4146ed5540412e36bdd5a">dynamorio::drmemtrace::TRACE_MARKER_TYPE_KERNEL_EVENT</a> - This identifies kernel-initiated control transfers such as signal delivery. The next instruction record is the start of the handler for a kernel-initiated event. The value of this type of marker contains the program counter at the kernel interruption point. If the interruption point is just after a branch, this value is the target of that branch.</li>
<li><a class="el" href="namespacedynamorio_1_1drmemtrace.html#ab8531c7f66ccc0d7fe59f436844a295ca6b85d979c3dbcd4dd614c4399067ba73">dynamorio::drmemtrace::TRACE_MARKER_TYPE_KERNEL_XFER</a> - This identifies a system call that changes control flow, such as a signal return.</li>
<li><a class="el" href="namespacedynamorio_1_1drmemtrace.html#ab8531c7f66ccc0d7fe59f436844a295ca5935654bf36c3cb4e813ff0d8397e2ad">dynamorio::drmemtrace::TRACE_MARKER_TYPE_TIMESTAMP</a> - The marker value provides a timestamp for this point of the trace (in units of microseconds since Jan 1, 1601 UTC). This value can be used to synchronize records from different threads. It is used in the sequential analysis of a multi-threaded trace.</li>
<li><a class="el" href="namespacedynamorio_1_1drmemtrace.html#ab8531c7f66ccc0d7fe59f436844a295ca0f5122cab14b6654b276de4aa7f8183c">dynamorio::drmemtrace::TRACE_MARKER_TYPE_CPU_ID</a> - The marker value contains the CPU identifier on which the subsequent records were collected. It is useful to help track thread migrations occurring during execution. This marker is written to the header of each trace buffer when the buffer is flushed. Note that if the thread migrates to a different CPU due to preemption by the kernel before a buffer is full, we do not output a separate <a class="el" href="namespacedynamorio_1_1drmemtrace.html#ab8531c7f66ccc0d7fe59f436844a295ca0f5122cab14b6654b276de4aa7f8183c">dynamorio::drmemtrace::TRACE_MARKER_TYPE_CPU_ID</a> marker to capture the previous CPU identifier. However, we expect such cases to be rare.</li>
<li><a class="el" href="namespacedynamorio_1_1drmemtrace.html#ab8531c7f66ccc0d7fe59f436844a295ca5c6f08548563cb1456a4f09b9b5c3f59">dynamorio::drmemtrace::TRACE_MARKER_TYPE_FUNC_ID</a>, <a class="el" href="namespacedynamorio_1_1drmemtrace.html#ab8531c7f66ccc0d7fe59f436844a295caaf1dc361b0b77c739bf4d0f87c7c43b9">dynamorio::drmemtrace::TRACE_MARKER_TYPE_FUNC_RETADDR</a>, <a class="el" href="namespacedynamorio_1_1drmemtrace.html#ab8531c7f66ccc0d7fe59f436844a295caf3a4f4b91cea5bb55ed8d9caae221e7c">dynamorio::drmemtrace::TRACE_MARKER_TYPE_FUNC_ARG</a>, <a class="el" href="namespacedynamorio_1_1drmemtrace.html#ab8531c7f66ccc0d7fe59f436844a295ca58ff903618a785cb45ba4c57900db24f">dynamorio::drmemtrace::TRACE_MARKER_TYPE_FUNC_RETVAL</a> - These markers are used to capture information about function calls. Which functions to capture must be explicitly selected at tracing time. Typical candiates are heap allocation and freeing functions. See <a class="el" href="sec_drcachesim_funcs.html">Tracing Function Calls</a>.</li>
<li><a class="el" href="namespacedynamorio_1_1drmemtrace.html#ab8531c7f66ccc0d7fe59f436844a295ca02845c6ba33cc5038f8a7bfe38c25f57">dynamorio::drmemtrace::TRACE_MARKER_TYPE_WINDOW_ID</a> - The marker value contains the ordinal of the trace burst window when the subsequent entries until the next <a class="el" href="namespacedynamorio_1_1drmemtrace.html#ab8531c7f66ccc0d7fe59f436844a295ca02845c6ba33cc5038f8a7bfe38c25f57">dynamorio::drmemtrace::TRACE_MARKER_TYPE_WINDOW_ID</a> or end-of-trace were collected (see <a class="el" href="sec_drcachesim_partial.html">Tracing a Subset of Execution</a>).</li>
</ul>
<p>The full set of markers is listed under the enum <a class="el" href="namespacedynamorio_1_1drmemtrace.html#ab8531c7f66ccc0d7fe59f436844a295c">dynamorio::drmemtrace::trace_marker_type_t</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer" style="float:none;text-align:center"><img border=0 src="favicon.png"> &nbsp;  DynamoRIO version 10.0.19656 --- Sat Nov 23 2024 20:38:57 &nbsp; <img border=0 src="favicon.png">
</small></address>
<!--END !GENERATE_TREEVIEW-->
</body>
</html>
